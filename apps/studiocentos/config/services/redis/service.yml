# ============================================================================
# REDIS SERVICE - Cache & Session Store
# ============================================================================

redis:
  image: redis:7-alpine
  container_name: studiocentos-cache
  restart: unless-stopped
  
  # Command with password
  command: >
    redis-server
    --requirepass ${REDIS_PASSWORD:-studiocentos2025}
    --maxmemory 512mb
    --maxmemory-policy allkeys-lru
    --appendonly yes
    --appendfsync everysec
  
  # Ports
  ports:
    - "${REDIS_PORT:-6379}:6379"
  
  # Volumes
  volumes:
    - redis_data:/data
    - ./redis.conf:/usr/local/etc/redis/redis.conf:ro
  
  # Networks
  networks:
    - studiocentos
  
  # Health check
  healthcheck:
    test: ["CMD", "redis-cli", "-a", "${REDIS_PASSWORD:-studiocentos2025}", "ping"]
    interval: 10s
    timeout: 5s
    retries: 5
    start_period: 5s
  
  # Resources
  deploy:
    resources:
      limits:
        cpus: '1'
        memory: 512M
      reservations:
        cpus: '0.5'
        memory: 256M
  
  # Logging
  logging:
    driver: "json-file"
    options:
      max-size: "10m"
      max-file: "3"
