# ============================================================================
# PROMETHEUS SERVICE - Metrics & Monitoring
# ============================================================================

prometheus:
  image: prom/prometheus:latest
  container_name: studiocentos-prometheus
  restart: unless-stopped
  
  # Command
  command:
    - '--config.file=/etc/prometheus/prometheus.yml'
    - '--storage.tsdb.path=/prometheus'
    - '--storage.tsdb.retention.time=30d'
    - '--web.console.libraries=/usr/share/prometheus/console_libraries'
    - '--web.console.templates=/usr/share/prometheus/consoles'
  
  # Ports
  ports:
    - "${PROMETHEUS_PORT:-9090}:9090"
  
  # Volumes
  volumes:
    - ./prometheus.yml:/etc/prometheus/prometheus.yml:ro
    - ./alerts.yml:/etc/prometheus/alerts.yml:ro
    - prometheus_data:/prometheus
  
  # Networks
  networks:
    - studiocentos
  
  # Health check
  healthcheck:
    test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:9090/-/healthy"]
    interval: 30s
    timeout: 10s
    retries: 3
  
  # Labels
  labels:
    - "traefik.enable=true"
    - "traefik.http.routers.prometheus.rule=Host(`prometheus.${DOMAIN:-localhost}`)"
    - "traefik.http.services.prometheus.loadbalancer.server.port=9090"
  
  # Resources
  deploy:
    resources:
      limits:
        cpus: '1'
        memory: 1G
      reservations:
        cpus: '0.5'
        memory: 512M
